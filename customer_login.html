<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Support System</title>
  <link rel="stylesheet" href="style/login.css" />
  <style>
    .error-message {
      color: #dc3545;
      margin: 10px 0;
      padding: 10px;
      background: #f8d7da;
      border-radius: 4px;
      display: none;
    }
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 8px;
      vertical-align: middle;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <h2>Customer Login</h2>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <div id="errorMessage" class="error-message"></div>
      <button type="submit" id="loginButton">
        <span id="buttonText">Login</span>
        <span id="buttonSpinner" class="loading" style="display: none;"></span>
      </button>
      <p>Don't have an account? <a href="customer_signup.html">Sign up</a></p>
      <p><a href="forgot_password.html" style="color: #007BFF;">Forgot password?</a></p>
    </form>
    
    <div style="margin-top: 20px; text-align: center;">
      <a href="index.html" style="color: #007BFF; text-decoration: none;">‚Üê Go Back</a>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const SUPABASE_URL = 'https://iradphcrwwokdrnhxpnd.supabase.co'; 
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyYWRwaGNyd3dva2Rybmh4cG5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3MTI5ODEsImV4cCI6MjA2MjI4ODk4MX0.X1okOgCMPHNh_vufxDnSlENTO99tMDjkSOXMeWawNrU'; 

      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const loginForm = document.getElementById('loginForm');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const errorMessage = document.getElementById('errorMessage');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = emailInput.value.trim();
        const password = passwordInput.value;

        // Show loading spinner
        buttonText.style.display = 'none';
        buttonSpinner.style.display = 'inline-block';

        const { data, error } = await supabaseClient
        .from('customers')
       .select('*')
       .eq('email', email)
       .eq('password', password)
  .single();

        console.log('Supabase login response:', { data, error });

        // Hide loading spinner
        buttonText.style.display = 'inline';
        buttonSpinner.style.display = 'none';

        if (error || !data) {
          errorMessage.style.display = 'block';
          errorMessage.textContent = 'Invalid email or password.';
        } else {
          errorMessage.style.display = 'none'; // Clear previous errors
          localStorage.setItem('customer_id', data.customer_id);
          localStorage.setItem('customer_name', data.name);
          window.location.href = 'customer.html'; // Redirect to your actual dashboard page
        }
      });
    });
  </script>
</body>
</html>
